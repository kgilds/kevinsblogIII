{
  "hash": "4ff6190d1dfac4487f68f7ba5811667c",
  "result": {
    "markdown": "---\ntitle: \"Population Pyramids\"\ndescription: |\n  Working with Tidy Census Data\nauthor: Kevn Gilds, MPA\ndate: 2023-09-10\ncategories:\n -Census, ACS pyramid-plots\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(plotly)\n```\n:::\n\n\nI am working through creating Population Pyramids using the [tidycensus package](https://walker-data.com/tidycensus/articles/other-datasets.html). Also here is another [tutorial](https://www.spsanderson.com/steveondata/posts/2023-09-08/index.html) on Pyramid Plots.\n\nThe graph below is copy of the example from the article; the only change is I changed to Polk County Florida, and will add some code comments to help me understand how the code works.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npolk <- get_estimates(geography = \"county\", \n                             product = \"characteristics\", \n                             breakdown = c(\"SEX\", \"AGEGROUP\", \"HISP\"),  \n                             breakdown_labels = TRUE, \n                             state = \"FL\", \n                             county = \"Polk\")\n```\n:::\n\n\nReview the data structure.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndplyr::glimpse (polk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 114\nColumns: 7\n$ GEOID    <chr> \"12105\", \"12105\", \"12105\", \"12105\", \"12105\", \"12105\", \"12105\"…\n$ NAME     <chr> \"Polk County, Florida\", \"Polk County, Florida\", \"Polk County,…\n$ year     <int> 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2…\n$ SEX      <chr> \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male…\n$ AGEGROUP <fct> All ages, All ages, All ages, Age 0 to 4 years, Age 0 to 4 ye…\n$ HISP     <chr> \"Both Hispanic Origins\", \"Non-Hispanic\", \"Hispanic\", \"Both Hi…\n$ value    <dbl> 389036, 273105, 115931, 22146, 13638, 8508, 24387, 15188, 919…\n```\n:::\n\n```{.r .cell-code}\nhead(polk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  GEOID NAME                  year SEX   AGEGROUP         HISP             value\n  <chr> <chr>                <int> <chr> <fct>            <chr>            <dbl>\n1 12105 Polk County, Florida  2022 Male  All ages         Both Hispanic … 389036\n2 12105 Polk County, Florida  2022 Male  All ages         Non-Hispanic    273105\n3 12105 Polk County, Florida  2022 Male  All ages         Hispanic        115931\n4 12105 Polk County, Florida  2022 Male  Age 0 to 4 years Both Hispanic …  22146\n5 12105 Polk County, Florida  2022 Male  Age 0 to 4 years Non-Hispanic     13638\n6 12105 Polk County, Florida  2022 Male  Age 0 to 4 years Hispanic          8508\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncompare <- filter(polk, str_detect(AGEGROUP, \"^Age\"), #exclude all ages\n                  HISP != \"Both Hispanic Origins\", #this helps us segement by eth rather than totals\n                  SEX != \"Both sexes\") %>% #again we want to segement by eth and sex. \n  mutate(value = ifelse(SEX == \"Male\", -value, value)) #I think this used for plotting and using the abolute value for the pyramid plot. \n\nggplot(compare, aes(x = AGEGROUP, y = value, fill = SEX)) + \n  geom_bar(stat = \"identity\", width = 1) + \n  theme_minimal(base_family = \"Roboto\") + \n  scale_y_continuous(labels = function(y) paste0(abs(y / 1000), \"k\")) +  #I have no idea what abs is. Is is abreivation or aboslute value. \n  scale_x_discrete(labels = function(x) gsub(\"Age | years\", \"\", x)) + \n  scale_fill_manual(values = c(\"darkred\", \"navy\")) + \n  coord_flip() + \n  facet_wrap(~HISP) + \n  labs(x = \"\", \n       y = \"2022 Census Bureau population estimate\", \n       title = \"Population structure by Hispanic origin\", \n       subtitle = \"Polk County, Florida\", \n       fill = \"\", \n       caption = \"Data source: US Census Bureau population estimates & tidycensus R package\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nHere is how Chat GPT3 [Answered](https://chat.openai.com/share/16006d78-8f3c-483a-8f3a-c4d5ef2e2ac6) my questions.\n\nLets riff on this and get a Population Pyramid based on just SEX.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnon_eth <- filter(polk, str_detect(AGEGROUP, \"^Age\"), #exclude all ages\n                  HISP == \"Both Hispanic Origins\", #this helps us segement by eth rather than totals\n                  SEX != \"Both sexes\") %>% #again we want to segement by eth and sex. \n  mutate(value = ifelse(SEX == \"Male\", -value, value)) #I think this used for plotting and using the abolute value for t\n```\n:::\n\n\nAgain, review the data and its structure.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndplyr::glimpse (non_eth)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 36\nColumns: 7\n$ GEOID    <chr> \"12105\", \"12105\", \"12105\", \"12105\", \"12105\", \"12105\", \"12105\"…\n$ NAME     <chr> \"Polk County, Florida\", \"Polk County, Florida\", \"Polk County,…\n$ year     <int> 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2…\n$ SEX      <chr> \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male…\n$ AGEGROUP <fct> Age 0 to 4 years, Age 5 to 9 years, Age 10 to 14 years, Age 1…\n$ HISP     <chr> \"Both Hispanic Origins\", \"Both Hispanic Origins\", \"Both Hispa…\n$ value    <dbl> -22146, -24387, -25485, -25844, -25352, -24998, -27862, -2627…\n```\n:::\n\n```{.r .cell-code}\nhead(non_eth)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  GEOID NAME                  year SEX   AGEGROUP           HISP           value\n  <chr> <chr>                <int> <chr> <fct>              <chr>          <dbl>\n1 12105 Polk County, Florida  2022 Male  Age 0 to 4 years   Both Hispani… -22146\n2 12105 Polk County, Florida  2022 Male  Age 5 to 9 years   Both Hispani… -24387\n3 12105 Polk County, Florida  2022 Male  Age 10 to 14 years Both Hispani… -25485\n4 12105 Polk County, Florida  2022 Male  Age 15 to 19 years Both Hispani… -25844\n5 12105 Polk County, Florida  2022 Male  Age 20 to 24 years Both Hispani… -25352\n6 12105 Polk County, Florida  2022 Male  Age 25 to 29 years Both Hispani… -24998\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npolk_sex <- ggplot(non_eth, aes(x = AGEGROUP, y = value, fill = SEX)) + \n  geom_bar(stat = \"identity\", width = .85) + \n  theme_minimal(base_family = \"Roboto\") + \n  scale_y_continuous(labels = function(y) paste0(abs(y / 1000), \"k\")) +  #I have no idea what abs is. Is is abreivation or aboslute value. \n  scale_x_discrete(labels = function(x) gsub(\"Age | years\", \"\", x)) + \n  scale_fill_manual(values = c(\"darkred\", \"navy\")) + \n  coord_flip() + \n  labs(x = \"\", \n       y = \"2022 Census Bureau population estimate\", \n       title = \"Population structure by SEX\", \n       subtitle = \"Polk County, Florida\", \n       fill = \"\", \n       caption = \"Data source: US Census Bureau population estimates & tidycensus R package\")\n\npolk_sex\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nI updated the width of the bars for this plot. I think it looks better and it helps me see the pattern.\n\nI think it may be helpful to make the plot interactive\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninteractive_plot <- plotly::ggplotly(polk_sex)\n\ninteractive_plot\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-3b990447d91dd4ef07d1\" style=\"width:100%;height:464px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3b990447d91dd4ef07d1\">{\"x\":{\"data\":[{\"orientation\":\"h\",\"width\":[0.85,0.85,0.85,0.85,0.85,0.85,0.85,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001],\"base\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"x\":[21571,23153,24297,24657,25061,24779,27307,25482,24688,23056,23031,23407,23971,23751,21796,17521,10831,10009],\"y\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],\"text\":[\"AGEGROUP: Age 0 to 4 years<br />value: 21571<br />SEX: Female\",\"AGEGROUP: Age 5 to 9 years<br />value: 23153<br />SEX: Female\",\"AGEGROUP: Age 10 to 14 years<br />value: 24297<br />SEX: Female\",\"AGEGROUP: Age 15 to 19 years<br />value: 24657<br />SEX: Female\",\"AGEGROUP: Age 20 to 24 years<br />value: 25061<br />SEX: Female\",\"AGEGROUP: Age 25 to 29 years<br />value: 24779<br />SEX: Female\",\"AGEGROUP: Age 30 to 34 years<br />value: 27307<br />SEX: Female\",\"AGEGROUP: Age 35 to 39 years<br />value: 25482<br />SEX: Female\",\"AGEGROUP: Age 40 to 44 years<br />value: 24688<br />SEX: Female\",\"AGEGROUP: Age 45 to 49 years<br />value: 23056<br />SEX: Female\",\"AGEGROUP: Age 50 to 54 years<br />value: 23031<br />SEX: Female\",\"AGEGROUP: Age 55 to 59 years<br />value: 23407<br />SEX: Female\",\"AGEGROUP: Age 60 to 64 years<br />value: 23971<br />SEX: Female\",\"AGEGROUP: Age 65 to 69 years<br />value: 23751<br />SEX: Female\",\"AGEGROUP: Age 70 to 74 years<br />value: 21796<br />SEX: Female\",\"AGEGROUP: Age 75 to 79 years<br />value: 17521<br />SEX: Female\",\"AGEGROUP: Age 80 to 84 years<br />value: 10831<br />SEX: Female\",\"AGEGROUP: Age 85 years and older<br />value: 10009<br />SEX: Female\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(139,0,0,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"Female\",\"legendgroup\":\"Female\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"h\",\"width\":[0.85,0.85,0.85,0.85,0.85,0.85,0.85,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001,0.850000000000001],\"base\":[-22146,-24387,-25485,-25844,-25352,-24998,-27862,-26279,-24964,-22661,-23379,-22689,-22258,-20803,-18550,-14830,-9280,-7269],\"x\":[22146,24387,25485,25844,25352,24998,27862,26279,24964,22661,23379,22689,22258,20803,18550,14830,9280,7269],\"y\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],\"text\":[\"AGEGROUP: Age 0 to 4 years<br />value: 22146<br />SEX: Male\",\"AGEGROUP: Age 5 to 9 years<br />value: 24387<br />SEX: Male\",\"AGEGROUP: Age 10 to 14 years<br />value: 25485<br />SEX: Male\",\"AGEGROUP: Age 15 to 19 years<br />value: 25844<br />SEX: Male\",\"AGEGROUP: Age 20 to 24 years<br />value: 25352<br />SEX: Male\",\"AGEGROUP: Age 25 to 29 years<br />value: 24998<br />SEX: Male\",\"AGEGROUP: Age 30 to 34 years<br />value: 27862<br />SEX: Male\",\"AGEGROUP: Age 35 to 39 years<br />value: 26279<br />SEX: Male\",\"AGEGROUP: Age 40 to 44 years<br />value: 24964<br />SEX: Male\",\"AGEGROUP: Age 45 to 49 years<br />value: 22661<br />SEX: Male\",\"AGEGROUP: Age 50 to 54 years<br />value: 23379<br />SEX: Male\",\"AGEGROUP: Age 55 to 59 years<br />value: 22689<br />SEX: Male\",\"AGEGROUP: Age 60 to 64 years<br />value: 22258<br />SEX: Male\",\"AGEGROUP: Age 65 to 69 years<br />value: 20803<br />SEX: Male\",\"AGEGROUP: Age 70 to 74 years<br />value: 18550<br />SEX: Male\",\"AGEGROUP: Age 75 to 79 years<br />value: 14830<br />SEX: Male\",\"AGEGROUP: Age 80 to 84 years<br />value:  9280<br />SEX: Male\",\"AGEGROUP: Age 85 years and older<br />value:  7269<br />SEX: Male\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,0,128,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"Male\",\"legendgroup\":\"Male\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":81.0958904109589},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"Roboto\",\"size\":14.6118721461187},\"title\":{\"text\":\"Population structure by SEX\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"Roboto\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-30620.45,30065.45],\"tickmode\":\"array\",\"ticktext\":[\"30k\",\"20k\",\"10k\",\"0k\",\"10k\",\"20k\",\"30k\"],\"tickvals\":[-30000,-20000,-10000,3.63797880709171e-12,10000,20000,30000],\"categoryorder\":\"array\",\"categoryarray\":[\"30k\",\"20k\",\"10k\",\"0k\",\"10k\",\"20k\",\"30k\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"Roboto\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"2022 Census Bureau population estimate\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"Roboto\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.4,18.6],\"tickmode\":\"array\",\"ticktext\":[\"0 to 4\",\"5 to 9\",\"10 to 14\",\"15 to 19\",\"20 to 24\",\"25 to 29\",\"30 to 34\",\"35 to 39\",\"40 to 44\",\"45 to 49\",\"50 to 54\",\"55 to 59\",\"60 to 64\",\"65 to 69\",\"70 to 74\",\"75 to 79\",\"80 to 84\",\"85 and older\"],\"tickvals\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],\"categoryorder\":\"array\",\"categoryarray\":[\"0 to 4\",\"5 to 9\",\"10 to 14\",\"15 to 19\",\"20 to 24\",\"25 to 29\",\"30 to 34\",\"35 to 39\",\"40 to 44\",\"45 to 49\",\"50 to 54\",\"55 to 59\",\"60 to 64\",\"65 to 69\",\"70 to 74\",\"75 to 79\",\"80 to 84\",\"85 and older\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"Roboto\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"Roboto\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":true,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"Roboto\",\"size\":11.689497716895},\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"Roboto\",\"size\":14.6118721461187}}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"325267d4f74c3\":{\"x\":{},\"y\":{},\"fill\":{},\"type\":\"bar\"}},\"cur_data\":\"325267d4f74c3\",\"visdat\":{\"325267d4f74c3\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/plotly-binding-4.10.0/plotly.js\"></script>\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/plotly-main-2.5.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}