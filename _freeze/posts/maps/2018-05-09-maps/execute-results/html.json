{
  "hash": "d505d3a6fc64b5d5d7647d0b214572ae",
  "result": {
    "markdown": "---\ntitle: Maps\nauthor: kevin\ndate: '2018-05-09'\nslug: maps\ncategories:\n  - R\ntags: []\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6     ✔ purrr   0.3.4\n✔ tibble  3.1.8     ✔ dplyr   1.0.9\n✔ tidyr   1.2.0     ✔ stringr 1.4.0\n✔ readr   2.1.2     ✔ forcats 0.5.1\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(janitor)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n:::\n\n```{.r .cell-code}\nlibrary(httr)\nlibrary(ggmap)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nGoogle's Terms of Service: https://cloud.google.com/maps-platform/terms/.\nPlease cite ggmap if you use it! See citation(\"ggmap\") for details.\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /home/kgilds/kevinsblogIII\n```\n:::\n:::\n\n\n# Intro\n\nMy issue list includes a task to map the Fl Absences data set.\n\n## Get the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- 'https://www.fldoe.org/core/fileparse.php/7584/urlt/1516ABS21DAYSTDistSchl.xlsx' #location of data on the internet\n\n\n#httr::GET(url, write_disk(absences <- tempfile(fileext = \".xls\"))) #obtain the spreadsheet file from the internet\n```\n:::\n\n\n## Read the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabsences_2 <- readxl::read_excel(\nhere(\"posts\", \"maps\", \"absences.xlsx\"),\n     skip =2) #read the spreadsheet file and skip the first two rows\n\n\n\n\n\nabsences_2 <- janitor::clean_names(absences_2) #Change column names with the Janitor.\n\n\nabsences_2 <- dplyr::rename(absences_2, \"absent_21_plus\" = \"absent_21_days_or_over\") #Change name again to shorten\n\nabsences_2 <- dplyr::select(absences_2, 2, 4:5) #select columsn of interest\n```\n:::\n\n\n## Clean and Convert the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#absences_2$enrollments <- as.numeric(absences_2$enrollments) #Change data to numeric format\nabsences_2$absent_21_plus <- as.numeric(absences_2$absent_21_plus) #change data to numeric format\n```\n:::\n\n\n## Make my own percents\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#absences_2 <- dplyr::mutate(absences_2, percent = absent_21_plus / enrollments) \n\n\n#calculate percent \nabsences_2 <- dplyr::mutate(absences_2, percent = percent_absent_21_or_more_days *100) #Convert from decimal \n```\n:::\n\n\n## Summary Stats for plotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabsent_21 <- absences_2 %>%\n  group_by(district_name) %>%\n  summarise(mean = mean(percent, na.rm = TRUE))\n\n\n\nabsent_21$mean <- round(absent_21$mean, 2)\n\nabsent_21\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 75 × 2\n   district_name  mean\n   <chr>         <dbl>\n 1 ALACHUA       13.9 \n 2 BAKER         21.0 \n 3 BAY           12.7 \n 4 BRADFORD      18.6 \n 5 BREVARD        6.62\n 6 BROWARD        8.71\n 7 CALHOUN       20.9 \n 8 CHARLOTTE      7.58\n 9 CITRUS        11.0 \n10 CLAY           9.78\n# … with 65 more rows\n```\n:::\n:::\n\n\n## Maps\n\n### Get Florida Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates <- map_data(\"state\")\nfl_df <- subset(states, region == \"florida\")\n```\n:::\n\n\nThis chunks sets up how to overlay county boundaries over the Florida map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties <- map_data(\"county\")\nfl_county <- subset(counties, region == \"florida\")\n```\n:::\n\n\nThis will us a map of Florida\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfl_base <- ggplot(data = fl_df, mapping = aes(x = long, y = lat, group = group)) + \n  coord_fixed(1.3) + \n  geom_polygon(color = \"black\", fill = \"gray\")\nfl_base + theme_nothing()\n```\n\n::: {.cell-output-display}\n![](2018-05-09-maps_files/figure-html/fl_base-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfl_base + theme_nothing() + \n  geom_polygon(data = fl_county, fill = NA, color = \"white\") +\n  geom_polygon(color = \"black\", fill = NA)  # get the state border back on top\n```\n\n::: {.cell-output-display}\n![](2018-05-09-maps_files/figure-html/fl_base-fl-county-1.png){width=672}\n:::\n:::\n\n\n## Back to the educational set\n\nSchool districts in Florida pretty much align with Florida Counties. However, there is nuance between the map data and the school district data.\n\nThis chunk renames the district_name to match the name in the map data and matches the case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabsent_21_c <- absent_21 %>%\n  rename(\"subregion\" = \"district_name\") #match name with map data in preperation of joining. \n\nabsent_21_c$subregion <- tolower(absent_21_c$subregion) #make lowercase\n\nabsent_21_c\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 75 × 2\n   subregion  mean\n   <chr>     <dbl>\n 1 alachua   13.9 \n 2 baker     21.0 \n 3 bay       12.7 \n 4 bradford  18.6 \n 5 brevard    6.62\n 6 broward    8.71\n 7 calhoun   20.9 \n 8 charlotte  7.58\n 9 citrus    11.0 \n10 clay       9.78\n# … with 65 more rows\n```\n:::\n:::\n\n\n## Use the anti-join to determine issues with merging\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnon_match <- anti_join(fl_county, absent_21_c, by = \"subregion\")\n\nnon_match\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         long      lat group order  region  subregion\n1   -80.89018 25.79456   302 12629 florida miami-dade\n2   -80.89018 25.97218   302 12630 florida miami-dade\n3   -80.69538 25.96645   302 12631 florida miami-dade\n4   -80.68965 25.94926   302 12632 florida miami-dade\n5   -80.30003 25.94926   302 12633 florida miami-dade\n6   -80.30003 25.96072   302 12634 florida miami-dade\n7   -80.13387 25.96072   302 12635 florida miami-dade\n8   -80.13961 25.90342   302 12636 florida miami-dade\n9   -80.12814 25.85186   302 12637 florida miami-dade\n10  -80.12814 25.81748   302 12638 florida miami-dade\n11  -80.12814 25.79456   302 12639 florida miami-dade\n12  -80.13387 25.78310   302 12640 florida miami-dade\n13  -80.14534 25.77737   302 12641 florida miami-dade\n14  -80.16252 25.78310   302 12642 florida miami-dade\n15  -80.16825 25.80029   302 12643 florida miami-dade\n16  -80.16825 25.82321   302 12644 florida miami-dade\n17  -80.16252 25.85759   302 12645 florida miami-dade\n18  -80.17398 25.85759   302 12646 florida miami-dade\n19  -80.18545 25.85186   302 12647 florida miami-dade\n20  -80.19691 25.83467   302 12648 florida miami-dade\n21  -80.20263 25.78883   302 12649 florida miami-dade\n22  -80.20836 25.75445   302 12650 florida miami-dade\n23  -80.21982 25.73726   302 12651 florida miami-dade\n24  -80.25420 25.72008   302 12652 florida miami-dade\n25  -80.26566 25.69716   302 12653 florida miami-dade\n26  -80.27712 25.63986   302 12654 florida miami-dade\n27  -80.30003 25.62840   302 12655 florida miami-dade\n28  -80.31149 25.61694   302 12656 florida miami-dade\n29  -80.32296 25.59975   302 12657 florida miami-dade\n30  -80.32296 25.56538   302 12658 florida miami-dade\n31  -80.32296 25.54819   302 12659 florida miami-dade\n32  -80.33441 25.52527   302 12660 florida miami-dade\n33  -80.35160 25.49662   302 12661 florida miami-dade\n34  -80.35733 25.46225   302 12662 florida miami-dade\n35  -80.34587 25.42214   302 12663 florida miami-dade\n36  -80.32868 25.39349   302 12664 florida miami-dade\n37  -80.32868 25.37057   302 12665 florida miami-dade\n38  -80.33441 25.35338   302 12666 florida miami-dade\n39  -80.38598 25.33046   302 12667 florida miami-dade\n40  -80.39171 25.30182   302 12668 florida miami-dade\n41  -80.40317 25.29036   302 12669 florida miami-dade\n42  -80.42609 25.27317   302 12670 florida miami-dade\n43  -80.43755 25.23879   302 12671 florida miami-dade\n44  -80.44328 25.22160   302 12672 florida miami-dade\n45  -80.47192 25.23306   302 12673 florida miami-dade\n46  -80.48911 25.22733   302 12674 florida miami-dade\n47  -80.50057 25.20441   302 12675 florida miami-dade\n48  -80.51776 25.20441   302 12676 florida miami-dade\n49  -80.55787 25.23306   302 12677 florida miami-dade\n50  -80.58651 25.23879   302 12678 florida miami-dade\n51  -80.59798 25.23306   302 12679 florida miami-dade\n52  -80.59225 25.20441   302 12680 florida miami-dade\n53  -80.60944 25.19296   302 12681 florida miami-dade\n54  -80.63235 25.19296   302 12682 florida miami-dade\n55  -80.67818 25.18150   302 12683 florida miami-dade\n56  -80.71256 25.15858   302 12684 florida miami-dade\n57  -80.79278 25.15858   302 12685 florida miami-dade\n58  -80.82716 25.17576   302 12686 florida miami-dade\n59  -80.85007 25.18150   302 12687 florida miami-dade\n60  -80.89591 25.18150   302 12688 florida miami-dade\n61  -80.89018 25.79456   302 12689 florida miami-dade\n62  -81.56627 27.03215   303 12691 florida    de soto\n63  -82.05329 27.03215   303 12692 florida    de soto\n64  -82.05329 27.10090   303 12693 florida    de soto\n65  -82.21371 27.10090   303 12694 florida    de soto\n66  -82.21371 27.19831   303 12695 florida    de soto\n67  -82.15642 27.20403   303 12696 florida    de soto\n68  -82.15642 27.24414   303 12697 florida    de soto\n69  -82.05901 27.24987   303 12698 florida    de soto\n70  -82.05901 27.33582   303 12699 florida    de soto\n71  -81.56054 27.33582   303 12700 florida    de soto\n72  -81.56627 27.03215   303 12701 florida    de soto\n73  -81.57200 29.82245   345 14185 florida   st johns\n74  -81.59492 29.90267   345 14186 florida   st johns\n75  -81.58920 29.93704   345 14187 florida   st johns\n76  -81.60065 29.96569   345 14188 florida   st johns\n77  -81.66940 30.02299   345 14189 florida   st johns\n78  -81.66940 30.04591   345 14190 florida   st johns\n79  -81.66367 30.07456   345 14191 florida   st johns\n80  -81.66367 30.09174   345 14192 florida   st johns\n81  -81.66367 30.11466   345 14193 florida   st johns\n82  -81.63503 30.11466   345 14194 florida   st johns\n83  -81.62357 30.11466   345 14195 florida   st johns\n84  -81.59492 30.11466   345 14196 florida   st johns\n85  -81.55482 30.09748   345 14197 florida   st johns\n86  -81.53762 30.09174   345 14198 florida   st johns\n87  -81.53189 30.08601   345 14199 florida   st johns\n88  -81.43449 30.08601   345 14200 florida   st johns\n89  -81.42876 30.24644   345 14201 florida   st johns\n90  -81.36574 30.24644   345 14202 florida   st johns\n91  -81.35427 30.18915   345 14203 florida   st johns\n92  -81.33136 30.09748   345 14204 florida   st johns\n93  -81.29125 29.96569   345 14205 florida   st johns\n94  -81.27979 29.91986   345 14206 florida   st johns\n95  -81.29125 29.87975   345 14207 florida   st johns\n96  -81.26833 29.86256   345 14208 florida   st johns\n97  -81.25114 29.83391   345 14209 florida   st johns\n98  -81.25114 29.78808   345 14210 florida   st johns\n99  -81.24541 29.72505   345 14211 florida   st johns\n100 -81.23396 29.70213   345 14212 florida   st johns\n101 -81.21104 29.69067   345 14213 florida   st johns\n102 -81.19958 29.67348   345 14214 florida   st johns\n103 -81.19958 29.64484   345 14215 florida   st johns\n104 -81.25114 29.65056   345 14216 florida   st johns\n105 -81.29125 29.64484   345 14217 florida   st johns\n106 -81.30844 29.65056   345 14218 florida   st johns\n107 -81.31990 29.64484   345 14219 florida   st johns\n108 -81.31417 29.62765   345 14220 florida   st johns\n109 -81.52616 29.62192   345 14221 florida   st johns\n110 -81.52616 29.75370   345 14222 florida   st johns\n111 -81.53189 29.76516   345 14223 florida   st johns\n112 -81.57200 29.82245   345 14224 florida   st johns\n113 -80.33441 27.54781   346 14226 florida   st lucie\n114 -80.32868 27.50770   346 14227 florida   st lucie\n115 -80.32868 27.46760   346 14228 florida   st lucie\n116 -80.31149 27.43322   346 14229 florida   st lucie\n117 -80.27139 27.35301   346 14230 florida   st lucie\n118 -80.24274 27.29571   346 14231 florida   st lucie\n119 -80.21409 27.25560   346 14232 florida   st lucie\n120 -80.28857 27.25560   346 14233 florida   st lucie\n121 -80.28857 27.20403   346 14234 florida   st lucie\n122 -80.67245 27.20403   346 14235 florida   st lucie\n123 -80.67245 27.55354   346 14236 florida   st lucie\n124 -80.33441 27.54781   346 14237 florida   st lucie\n```\n:::\n:::\n\n\nNot all the names match; so a touchup of subregion names is called for.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabsent_21_c$subregion <- gsub(\"dade\", \"miami-dade\", fixed = TRUE, absent_21_c$subregion)\n\nabsent_21_c$subregion <- gsub(\"desoto\", \"de soto\", fixed = TRUE, absent_21_c$subregion)\n\nabsent_21_c$subregion <- gsub(\"st. johns\", \"st johns\", fixed = TRUE, absent_21_c$subregion)\n\nabsent_21_c$subregion <- gsub(\"st. lucie\", \"st lucie\", fixed = TRUE, absent_21_c$subregion)\n```\n:::\n\n\n### Join Forces\n\nPut the\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_d <- inner_join(fl_county, absent_21_c, by = \"subregion\") #join map data and educational data\n```\n:::\n\n\n# Map Set Up\n\nThis is where I started to blindly follow. In essence, what this chunk is doing is setting up the parameters of the theme.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nditch_the_axes <- theme(\n  axis.text = element_blank(),\n  axis.line = element_blank(),\n  axis.ticks = element_blank(),\n  panel.border = element_blank(),\n  panel.grid = element_blank(),\n  axis.title = element_blank()\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfl_abs <- fl_base + \n      geom_polygon(data = map_d, aes(fill = mean), color = \"white\") +\n      geom_polygon(color = \"black\", fill = NA) +\n      theme_bw() +\n      ditch_the_axes\n\nfl_abs\n```\n\n::: {.cell-output-display}\n![](2018-05-09-maps_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfl_abs_2 <- fl_abs + \n    scale_fill_gradientn(colours = rev(rainbow(7)),\n                         breaks = c(2, 4, 10, 100, 1000, 10000),\n                         trans = \"log10\")\nfl_abs_2\n```\n\n::: {.cell-output-display}\n![](2018-05-09-maps_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "2018-05-09-maps_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}